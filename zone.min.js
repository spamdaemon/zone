'use strict';(function(r,J){function D(a){function b(b,d){return l(a,b,d)}b.asFunction=function(a){u(arguments,2);return q(arguments)};b.asConstructor=function(a){u(arguments,2);return K(arguments)};b.asValue=function(a){u(arguments,1);return w(a)};b.inject=function(b,d){u(arguments,3);var e="",f=arguments;"string"===typeof arguments[0]&&(e=b,f=Array.prototype.slice.call(f,1));var k=q(f),h=null;return function(){null===h&&(h=l(a,e,!0).inject(k));return h.apply(this,arguments)}};b.get=function(b){u(arguments,
1);var d=new s(a,b,a);if(null===d.c)throw Error("Not found "+b);return d.c.get(d.local)};b.factory=function(c,d){var e=m(c),f=new s(a,e.name,a),k=l(a,f.h),h=Array.prototype.slice.call(arguments);h[0]=e.prefix+f.local;g.prototype.factory.apply(k,h);return b};b.service=function(c,d){var e=m(c),f=new s(a,e.name,a),k=l(a,f.h),h=Array.prototype.slice.call(arguments);h[0]=e.prefix+f.local;g.prototype.service.apply(k,h);return b};b.value=function(c,d){var e=m(c),f=new s(a,e.name,a);l(a,f.h).value(e.prefix+
f.local,d);return b};b.constant=function(c,d){var e=m(c),f=new s(a,e.name,a);l(a,f.h).constant(e.prefix+f.local,d);return b};b.makeZone=function(){return D(new g("",null,[]))};b.copyZone=function(){return D(L("",a,null))};b.names=function(b){var d,e,f,k=[],h;d="function"===typeof b?b:b instanceof RegExp?function(a){return b.test(a)}:function(){return!0};for(e in a.m)for(f in a.m[e].d)h=a.m[e].d[f],0===h.e&&d(h.f)&&k.push(h.f);k.sort();return k};b.version=function(){return"1.0"};a.d.$$zone=new v(a,
"$$zone",0,w(b));return b}function E(a){var b,c,d;if(!(a instanceof v)){d={};for(c in a)d[c]=E(a[c]);return d}if(a.r)return a.value;if(!0===a.n)throw Error("Cyclic dependency detected with "+a.f);a.n=!0;try{b=F(a,a.c.b.l,a.c.b.l.length-1),d=b()}catch(e){throw Error("Failed to resolve "+a.f+"\n"+e.toString());}finally{a.n=!1}a.value=d;a.r=!0;return d}function F(a,b,c){var d,e;if(0>c)return R(a);e=b[c];return e.u(a.c.a,a.name)?M(function(){var f,k;try{f=l(a.c.b,e.name,!0),k=G(f,2,e.i,!1,!0)}catch(h){throw r.log("Interceptor for "+
a.f+" failed"),h;}if(null===k)throw Error("Failed to resolve interceptor for "+a.name);d=F(a,b,c-1);return k()(d,a.c.a,a.name)}):F(a,b,c-1)}function R(a){return a.i instanceof z?function(){return a.i.value}:M(function(){var b;try{b=G(a.c,2,a.i,!1,!0)}catch(c){throw r.log("Failed to resolve "+a.f),c;}if(null===b)throw r.log("Failed to resolve "+a.f),Error("Failed to resolve "+a.f);return b()})}function M(a){var b,c=0;return function(){if(0===c)try{b=a(),c=1}catch(d){throw b=d,c=-1,d;}else if(0>c)throw b;
return b}}function G(a,b,c,d,e){var f,k,h,y,n,g,p,H,m,l;m=c.names;l=c.j;h=c.isConstructor;y=[];n=[null];f=0;for(k=m.length;f<k;++f)if(g=m[f],"#"===g[0]){if(!d)throw Error("Free arguments are not allowed");y.push(n.length);n.push(J)}else if(H=!1,"?"===g[0]&&(H=!0,g=g.substr(1)),c=I(g,a,b,!0,{})){try{p=E(c)}catch(q){throw r.log("Injection failed: "+g),q;}n.push(p)}else if(H)n.push(J);else return r.log("Injectable not found: "+g),null;k=y.length;return function(){for(f=0;f<k;++f)n[y[f]]=arguments[f];
e||(n[0]=this);var a=Function.prototype.bind.apply(l,n);return h?new a:a()}}function I(a,b,c,d,e){var f,k,h,g,n,m,p,l;n=new s(b.b,a,b);a=n.c;n=n.local;if(a!==b){g=b;if(g===a)g=2;else{for(;g&&g!==a;)g=g.p;g=null===g?0:1}c=Math.min(c,g)}p=null;if("*"===n)for(h in p={},a.d)g=a.d[h],g.s(c)&&(p[h]=g);for(e=e||{};!p&&a;){a.q=!0;if((p=a.d[n])&&p.s(c))break;p=null;if(!d)break;if(!p){if(!0===e[a.a])throw Error("Cyclic dependency : "+a.a);try{for(e[a.a]=!0,l=a.g||[],a.g=l,f=0,k=l.length;f<k&&!p;++f){m=A(b.b,
l[f],!1);if(null===m)throw Error("Invalid dependency : "+l[f]);p=I(n,m,0,!1,e)}}finally{e[a.a]=!1}c=1;a=a.p}}return p}function s(a,b,c){this.c=c;this.local=b;this.h=".";c=b.lastIndexOf(".");0<=c&&(this.h=b.substring(0,c),this.local=b.substr(c+1),this.c=A(a,this.h,!1))}function B(a,b,c,d){u(d,2);if(0===b.length||0<=b.indexOf("."))throw Error("Invalid name to bind "+b);if(a.d[b])throw Error("Name "+b+" already bound in "+a.a);N(a);d=d instanceof z||d instanceof t?d:1!==d.length||"function"===typeof d[0]||
d[0]instanceof t?q(d):w(d[0]);d instanceof t&&d.o("?","#");c=new v(a,b,c,d);a.d[b]=c;return a}function v(a,b,c,d){this.r=!1;this.value=null;this.c=a;this.name=b;this.f=O(a.a,b);this.i=d;this.n=!1;switch(c){case 0:case 2:case 1:this.e=c;break;default:throw Error("Invalid access "+c);}}function K(a){a=q(a);a.isConstructor=!0;return a}function q(a){return a instanceof t?a:1===a.length&&a[0]instanceof t?a[0]:new t(a)}function w(a){return a instanceof z?a:new z(a)}function z(a){this.value=a}function S(a,
b,c){this.name=a;this.u=b;this.i=c}function t(a){var b;this.isConstructor=!1;if(1===a.length&&C(a[0]))b=a[0].length,this.names=a[0].slice(0,b-1),this.j=a[0][b-1],P(this.names,this.j);else if(2===a.length)this.names=a[0].slice(),this.j=a[1],P(this.names,this.j);else if("function"===typeof a[0]){if(this.j=a[0],this.names=Q(this.j),null===this.names)throw Error("Failed to determine function signature");}else throw Error("Invalid function description"+JSON.stringify(a));}function P(a,b){var c=Q(b);if(null!==
c&&c.length!==a.length)throw Error("Formals and parameter names do not match : "+JSON.stringify(a));}function l(a,b,c){if(!b)return a;if(a=A(a,b,!c))return a;throw Error("Module not found "+b);}function A(a,b,c){var d=a.m[b],d=d||null;if(!d&&c&&(d=a,"."!==b))for(a=b.split(/\./),b=0,c=a.length;b<c;++b)d=d.create(a[b],null);return d}function N(a){if(a.q)throw Error("Module "+a.a+" is sealed");}function L(a,b,c){a=new g(a,c,null);b.g&&(a.g=b.g.slice());var d,e;a.b===a&&(a.l=b.l.slice());for(e in b.d)a.d[e]=
b.d[e].t(a);for(d in b.k)L(d,b.k[d],a);return a}function g(a,b,c){this.k={};this.p=b;this.g=c;this.q=!1;this.d={};this.a=a;if(b){if(b.k[a])throw Error("Module "+this.a+" already contains a module "+a);this.a=O(b.a,a);this.b=b.b;b.k[a]=this}else this.l=[],this.b=this,this.m={};this.b.m[this.a]=this}function O(a,b){return""===a?b:a+"."+b}function Q(a){if("function"!==typeof a)throw Error("Not a function: "+a);a=a.toString();var b=a.match(/^\s*function\s*(?:\w*\s*)?\(([\s\S]*?)\)/),b=b?b[1]?b[1].trim().split(/\s*,\s*/):
[]:null;null===b&&r.log("Failed to parse the function (perhaps it is too long?) : "+a);return b}function u(a,b){x(a,1);if(!(a.length<=b))throw Error("Expected at most "+b+" arguments, but got "+a.length);}function x(a,b){if(!(a.length>=b))throw Error("Expected at least "+b+" arguments, but got "+a.length);}function m(a){var b={};switch(a[0]){case "-":b.e=2;b.name=a.substr(1);b.prefix="-";break;case "+":b.e=0;b.name=a.substr(1);b.prefix="";break;case "#":b.e=1;b.name=a.substr(1);b.prefix="#";break;
default:b.e=0,b.name=a,b.prefix=""}return b}if(this.zone)return r.log("Zone has already been defined"),this.zone;var C=Array.isArray;C||(C=function(a){return 0<=a.length});t.prototype.o=function(a,b){var c=this.names.length,d;for(d=0;d<c;++d){for(var e=this.names[d],f=void 0,g=void 0,h=void 0,l=0,f=0,h=a.length;f<h;++f){g=e.indexOf(a[f]);if(0<g)throw Error("Invalid injection parameter "+e);if(0===g&&(++l,1<l))throw Error("Invalid injection parameter "+e);}f=0;for(h=b.length;f<h;++f)if(0<=e.indexOf(b[f]))throw Error("Invalid injection parameter "+
e);}};v.prototype.t=function(a){return new v(a,this.name,this.e,this.i)};v.prototype.s=function(a){return this.e<=a};g.prototype.inject=function(a){var b=q(arguments);b.o("#?","");b=G(this,0,b,!0,!1);if(null===b)throw Error("Failed to create injected function");return b};g.prototype.create=function(a){var b;if(0===a.length||0<=a.indexOf("."))throw Error("Invalid name "+a);(b=this.k[a])||(b=new g(a,this,null));return b};g.prototype.configure=function(a){if(!C(a))throw Error("Imports are not an array");
if(this.g)throw Error("Module has already been configured "+this.a);N(this);this.g=a.slice();return this};g.prototype.get=function(a){var b=I(a,this,0,!0,{});if(b)return E(b);throw Error("Not found "+a);};g.prototype.factory=function(a,b){x(arguments,2);var c=q(Array.prototype.slice.call(arguments,1)),d=m(a);return B(this,d.name,d.e,[c])};g.prototype.service=function(a,b){x(arguments,2);var c=K(Array.prototype.slice.call(arguments,1)),d=m(a);return B(this,d.name,d.e,[c])};g.prototype.value=function(a,
b){x(arguments,2);var c=m(a);return B(this,c.name,c.e,[w(b)])};g.prototype.constant=function(a,b){x(arguments,2);if(null!==b){var c=typeof b;if("object"===c||"function"===c)Object.freeze(b),Object.seal(b)}c=m(a);return B(this,c.name,c.e,[w(b)])};g.prototype.interceptor=function(a,b){var c=this;if("string"===typeof a){var d=new s(this.b,a,this),c=d.c;null===c&&(c=A(this.b,d.h,!0));a=function(a,b){return c.a===a&&b===d.local}}if("function"!==typeof a)throw Error("Invalid interceptor "+a);var e=q(Array.prototype.slice.call(arguments,
1));e.o("?","#");this.b.l.push(new S(this.a,a,e));return this};return this.zone=D(new g("",null,[]))}).call(this,console||{log:function(){}});
