(function(q){function D(a){var b,c,d,f,l,s;if(a.hasOwnProperty("value"))return a.value;if(!0===a.m)throw Error("Cyclic dependency detected with "+a.f);a.m=!0;if(a.e instanceof t)f=a.e.value;else{try{try{b=z(a.b,2,a.e,!1)}catch(h){throw q.log("Failed to resolve "+a.f),h;}if(null===b)throw q.log("Failed to resolve "+a.f),Error("Failed to resolve "+a.f);}finally{a.m=!1}try{f=b()}catch(g){throw Error("Failed to resolve "+a.f+"\n"+g.toString());}}b=m.o||[];l=0;for(s=b.length;l<s;++l)if(c=b[l],c.s(a.b.a,
a.name)){try{d=z(c.b,2,c.e,!1)}catch(e){throw q.log("Interceptor for "+a.f+" failed"),e;}if(null===d)throw Error("Failed to resolve interceptor for "+a.name);f=d()(f,a.b.a,a.name)}a.value=f;delete a.e;return a.value}function z(a,b,c,d){var f,l,s,h,g,e,n,k,m,p;m=c.d;p=c.g;s=c.isConstructor;h=[];g=[a];f=0;for(l=m.length;f<l;++f)if(e=m[f],"#"===e[0]){if(!d)throw Error("Free arguments are not allowed");h.push(g.length);g.push(void 0)}else if(k=!1,"?"===e[0]&&(k=!0,e=e.substr(1)),c=A(e,a,b,{})){try{n=
D(c)}catch(r){throw q.log("Injection failed: "+e),r;}g.push(n)}else if(k)g.push(void 0);else return q.log("Injectable not found: "+e),null;l=h.length;return function(){for(f=0;f<l;++f)g[h[f]]=arguments[f];var a=Function.prototype.bind.apply(p,g);return s?new a:a()}}function A(a,b,c,d){var f,l,e,h,g;e=new B(a,b);a=e.b;e=e.i;if(a!==b){if(b===a)b=2;else{for(;b&&b!==a;)b=b.p;b=null===b?0:1}c=Math.min(c,b)}d=d||{};for(b=null;!b&&a;){a.q=!0;if((b=a.k[e])&&b.r(c))break;b=null;if(!b){if(!0===d[a.a])throw Error("Cyclic dependency : "+
a.a);try{for(d[a.a]=!0,g=a.h||[],a.h=g,f=0,l=g.length;f<l&&!b;++f){h=u(g[f],!1);if(null===h)throw Error("Invalid dependency : "+g[f]);b=A(e,h,0,d)}}finally{d[a.a]=!1}c=1;a=a.p}}return b}function B(a,b){this.b=b;this.i=a;this.l=".";var c;c=a.lastIndexOf(".");0<=c&&(this.l=a.substring(0,c),this.b=u(this.l,!1),this.i=a.substr(c+1))}function v(a,b,c,d){p(d,2);if(0===b.length||0<=b.indexOf("."))throw Error("Invalid name to bind "+b);if(a.k[b])throw Error("Name "+b+" already bound in "+a.a);E(a);d=d instanceof
t||d instanceof n?d:1!==d.length||"function"===typeof d[0]||d[0]instanceof n?k(d):w(d[0]);d instanceof n&&d.n("?","#");c=new F(a,b,c,d);a.k[b]=c;return a}function F(a,b,c,d){this.b=a;this.name=b;this.f=G(a.a,b);this.e=d;this.m=!1;switch(c){case 0:case 2:case 1:this.c=c;break;default:throw Error("Invalid access "+c);}}function H(a){a=k(a);a.isConstructor=!0;return a}function k(a){return a instanceof n?a:1===a.length&&a[0]instanceof n?a[0]:new n(a)}function w(a){return a instanceof t?a:new t(a)}function t(a){this.value=
a}function K(a,b,c){this.b=a;this.s=b;this.e=c}function n(a){var b;this.isConstructor=!1;if(1===a.length&&x(a[0]))b=a[0].length,this.d=a[0].slice(0,b-1),this.g=a[0][b-1],I(this.d,this.g);else if(2===a.length)this.d=a[0].slice(),this.g=a[1],I(this.d,this.g);else if("function"===typeof a[0]){if(this.g=a[0],this.d=J(this.g),null===this.d)throw Error("Failed to determine function signature");}else throw Error("Invalid function description");}function I(a,b){var c=J(b);if(null!==c&&c.length!==a.length)throw Error("Formals and parameter names do not match");
}function u(a,b){var c=C[a],d,f,e,c=c||null;if(!c&&b)for(d=a.split(/\./),c=m,f=0,e=d.length;f<e;++f)c=c.create(d[f],null);return c}function E(a){if(a.q)throw Error("Module "+a.a+" is sealed");}function e(a,b,c){this.j={};this.p=b;this.h=c;this.q=!1;this.k={};this.a=a;if(b){if(b.j[a])throw Error("Module "+this.a+" already contains a module "+a);this.a=G(b.a,a);b.j[a]=this}else this.o=[];C[this.a]=this}function J(a){if("function"!==typeof a)throw Error("Not a function: "+a);a=a.toString();var b=a.match(/^\s*function\s*(?:\w*\s*)?\(([\s\S]*?)\)/),
b=b?b[1]?b[1].trim().split(/\s*,\s*/):[]:null;null===b&&q.log("Failed to parse the function (perhaps it is too long?) : "+a);return b}function G(a,b){return""===a?b:a+"."+b}function p(a,b){r(a,1);if(!(a.length<=b))throw Error("Expected at most "+b+" arguments, but got "+a.length);}function r(a,b){if(!(a.length>=b))throw Error("Expected at least "+b+" arguments, but got "+a.length);}function y(a){var b={};switch(a[0]){case "-":b.c=2;b.name=a.substr(1);break;case "+":b.c=0;b.name=a.substr(1);break;
case "#":b.c=1;b.name=a.substr(1);break;default:b.c=0,b.name=a}return b}if(this.zone)return q.log("Zone has already been defined"),this.zone;var C={},x=Array.isArray;x||(x=function(a){return 0<=a.length});var m=new e("",null,[]);n.prototype.n=function(a,b){var c=this.d.length,d;for(d=0;d<c;++d){for(var f=this.d[d],e=void 0,k=void 0,h=void 0,g=0,e=0,h=a.length;e<h;++e){k=f.indexOf(a[e]);if(0<k)throw Error("Invalid injection parameter "+f);if(0===k&&(++g,1<g))throw Error("Invalid injection parameter "+
f);}e=0;for(h=b.length;e<h;++e)if(0<=f.indexOf(b[e]))throw Error("Invalid injection parameter "+f);}};F.prototype.r=function(a){return this.c<=a};e.prototype.inject=function(a){var b=k(arguments);b.n("#?","");b=z(this,0,b,!0);if(null===b)throw Error("Failed to create injected function");return b};e.prototype.create=function(a){var b;if(0===a.length||0<=a.indexOf("."))throw Error("Invalid name "+a);(b=this.j[a])||(b=new e(a,this,null));return b};e.prototype.configure=function(a){if(!x(a))throw Error("Imports are not an array");
if(this.h)throw Error("Module has already been configured "+this.a);E(this);this.h=a.slice();return this};e.prototype.get=function(a){var b=A(a,this,0,{});if(b)return D(b);throw Error("Not found "+a);};e.prototype.factory=function(a,b){r(arguments,2);var c=k(Array.prototype.slice.call(arguments,1)),d=y(a);return v(this,d.name,d.c,[c])};e.prototype.service=function(a,b){r(arguments,2);var c=H(Array.prototype.slice.call(arguments,1)),d=y(a);return v(this,d.name,d.c,[c])};e.prototype.value=function(a,
b){r(arguments,2);var c=y(a);return v(this,c.name,c.c,[w(b)])};e.prototype.constant=function(a,b){r(arguments,2);if(null!==b){var c=typeof b;if("object"===c||"function"===c)Object.freeze(b),Object.seal(b)}c=y(a);return v(this,c.name,c.c,[w(b)])};e.prototype.interceptor=function(a,b){var c=this;if("string"===typeof a){var d=new B(a,this),c=d.b;null===c&&(c=u(d.l,!0));a=function(a,b){return c.a===a&&b===d.i}}if("function"!==typeof a)throw Error("Invalid interceptor "+interceptWhat);var e=k(Array.prototype.slice.call(arguments,
1));e.n("?","#");m.o.push(new K(this,a,e));return this};this.zone=function(a,b){if(!a)return m;var c=u(a,!b);if(c)return c;throw Error("Module not found "+a);};this.zone.asFunction=function(a){p(arguments,2);return k(arguments)};this.zone.asConstructor=function(a){p(arguments,2);return H(arguments)};this.zone.asValue=function(a){p(arguments,1);return w(a)};this.zone.inject=function(a,b){p(arguments,3);var c="",d=arguments;"string"===typeof arguments[0]&&(c=a,d=Array.prototype.slice.call(d,1));var e=
k(d);return function(){return zone(c,!0).inject(e).apply(null,arguments)}};this.zone.get=function(a){p(arguments,1);var b=new B(a,m);if(null===b.b)throw Error("Not found "+a);return b.b.get(b.i)};this.zone.reset=function(){m=new e("",null,[]);C={}};this.zone.version=function(){return"1.0"};return this.zone}).call(this,console||{log:function(){}});
