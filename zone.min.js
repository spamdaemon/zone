'use strict';(function(t,D){function E(){function a(a,d){return s(b,a,d)}var b=new h("",null,[]);a.asFunction=function(a){u(arguments,2);return m(arguments)};a.asConstructor=function(a){u(arguments,2);return F(arguments)};a.asValue=function(a){u(arguments,1);return w(a)};a.inject=function(a,d){u(arguments,3);var f="",e=arguments;"string"===typeof arguments[0]&&(f=a,e=Array.prototype.slice.call(e,1));var l=m(e),k=null;return function(){null===k&&(k=s(b,f,!0).inject(l));return k.apply(this,arguments)}};
a.get=function(a){u(arguments,1);var d=new p(b,a,b);if(null===d.b)throw Error("Not found "+a);return d.b.get(d.e)};a.factory=function(c,d){var f=q(c),e=new p(b,f.name,b),l=s(b,e.g),k=Array.prototype.slice.call(arguments);k[0]=f.prefix+e.e;h.prototype.factory.apply(l,k);return a};a.service=function(c,d){var f=q(c),e=new p(b,f.name,b),l=s(b,e.g),k=Array.prototype.slice.call(arguments);k[0]=f.prefix+e.e;h.prototype.service.apply(l,k);return a};a.value=function(c,d){var f=q(c),e=new p(b,f.name,b);s(b,
e.g).value(f.prefix+e.e,d);return a};a.constant=function(c,d){var f=q(c),e=new p(b,f.name,b);s(b,e.g).constant(f.prefix+e.e,d);return a};a.reset=function(){b=new h("",null,[])};a.makeZone=function(){return E()};a.version=function(){return"1.0"};return a}function G(a){var b,c,d,f,e,l;if(a.t)return a.value;if(!0===a.n)throw Error("Cyclic dependency detected with "+a.i);a.n=!0;if(a.h instanceof x)f=a.h.value;else{try{try{b=B(a.b,2,a.h,!1,!0)}catch(k){throw t.log("Failed to resolve "+a.i),k;}if(null===
b)throw t.log("Failed to resolve "+a.i),Error("Failed to resolve "+a.i);}finally{a.n=!1}try{f=b()}catch(h){throw Error("Failed to resolve "+a.i+"\n"+h.toString());}}b=a.b.c.p||[];e=0;for(l=b.length;e<l;++e)if(c=b[e],c.v(a.b.a,a.name)){try{d=B(c.b,2,c.h,!1,!0)}catch(g){throw t.log("Interceptor for "+a.i+" failed"),g;}if(null===d)throw Error("Failed to resolve interceptor for "+a.name);f=d()(f,a.b.a,a.name)}a.value=f;a.t=!0;delete a.h;return f}function B(a,b,c,d,f){var e,l,k,h,g,n,q,m,p,r;p=c.f;r=c.j;
k=c.isConstructor;h=[];g=[null];e=0;for(l=p.length;e<l;++e)if(n=p[e],"#"===n[0]){if(!d)throw Error("Free arguments are not allowed");h.push(g.length);g.push(D)}else if(m=!1,"?"===n[0]&&(m=!0,n=n.substr(1)),c=C(n,a,b,!0,{})){try{q=G(c)}catch(s){throw t.log("Injection failed: "+n),s;}g.push(q)}else if(m)g.push(D);else return t.log("Injectable not found: "+n),null;l=h.length;return function(){for(e=0;e<l;++e)g[h[e]]=arguments[e];f||(g[0]=this);var a=Function.prototype.bind.apply(r,g);return k?new a:
a()}}function C(a,b,c,d,f){var e,l,k,h,g,n;k=new p(b.c,a,b);a=k.b;k=k.e;if(a!==b){g=b;if(g===a)g=2;else{for(;g&&g!==a;)g=g.r;g=null===g?0:1}c=Math.min(c,g)}f=f||{};for(g=null;!g&&a;){a.s=!0;if((g=a.m[k])&&g.u(c))break;g=null;if(!d)break;if(!g){if(!0===f[a.a])throw Error("Cyclic dependency : "+a.a);try{for(f[a.a]=!0,n=a.k||[],a.k=n,e=0,l=n.length;e<l&&!g;++e){h=y(b.c,n[e],!1);if(null===h)throw Error("Invalid dependency : "+n[e]);g=C(k,h,0,!1,f)}}finally{f[a.a]=!1}c=1;a=a.r}}return g}function p(a,b,
c){this.b=c;this.e=b;this.g=".";c=b.lastIndexOf(".");0<=c&&(this.g=b.substring(0,c),this.e=b.substr(c+1),this.b=y(a,this.g,!1))}function z(a,b,c,d){u(d,2);if(0===b.length||0<=b.indexOf("."))throw Error("Invalid name to bind "+b);if(a.m[b])throw Error("Name "+b+" already bound in "+a.a);H(a);d=d instanceof x||d instanceof r?d:1!==d.length||"function"===typeof d[0]||d[0]instanceof r?m(d):w(d[0]);d instanceof r&&d.o("?","#");c=new I(a,b,c,d);a.m[b]=c;return a}function I(a,b,c,d){this.t=!1;this.value=
null;this.b=a;this.name=b;this.i=J(a.a,b);this.h=d;this.n=!1;switch(c){case 0:case 2:case 1:this.d=c;break;default:throw Error("Invalid access "+c);}}function F(a){a=m(a);a.isConstructor=!0;return a}function m(a){return a instanceof r?a:1===a.length&&a[0]instanceof r?a[0]:new r(a)}function w(a){return a instanceof x?a:new x(a)}function x(a){this.value=a}function M(a,b,c){this.b=a;this.v=b;this.h=c}function r(a){var b;this.isConstructor=!1;if(1===a.length&&A(a[0]))b=a[0].length,this.f=a[0].slice(0,
b-1),this.j=a[0][b-1],K(this.f,this.j);else if(2===a.length)this.f=a[0].slice(),this.j=a[1],K(this.f,this.j);else if("function"===typeof a[0]){if(this.j=a[0],this.f=L(this.j),null===this.f)throw Error("Failed to determine function signature");}else throw Error("Invalid function description"+JSON.stringify(a));}function K(a,b){var c=L(b);if(null!==c&&c.length!==a.length)throw Error("Formals and parameter names do not match");}function s(a,b,c){if(!b)return a;if(a=y(a,b,!c))return a;throw Error("Module not found "+
b);}function y(a,b,c){var d=a.q[b],d=d||null;if(!d&&c)for(b=b.split(/\./),d=a,a=0,c=b.length;a<c;++a)d=d.create(b[a],null);return d}function H(a){if(a.s)throw Error("Module "+a.a+" is sealed");}function h(a,b,c){this.l={};this.r=b;this.k=c;this.s=!1;this.m={};this.a=a;if(b){if(b.l[a])throw Error("Module "+this.a+" already contains a module "+a);this.a=J(b.a,a);this.c=b.c;b.l[a]=this}else this.p=[],this.c=this,this.q={};this.c.q[this.a]=this}function J(a,b){return""===a?b:a+"."+b}function L(a){if("function"!==
typeof a)throw Error("Not a function: "+a);a=a.toString();var b=a.match(/^\s*function\s*(?:\w*\s*)?\(([\s\S]*?)\)/),b=b?b[1]?b[1].trim().split(/\s*,\s*/):[]:null;null===b&&t.log("Failed to parse the function (perhaps it is too long?) : "+a);return b}function u(a,b){v(a,1);if(!(a.length<=b))throw Error("Expected at most "+b+" arguments, but got "+a.length);}function v(a,b){if(!(a.length>=b))throw Error("Expected at least "+b+" arguments, but got "+a.length);}function q(a){var b={};switch(a[0]){case "-":b.d=
2;b.name=a.substr(1);b.prefix="-";break;case "+":b.d=0;b.name=a.substr(1);b.prefix="";break;case "#":b.d=1;b.name=a.substr(1);b.prefix="#";break;default:b.d=0,b.name=a,b.prefix=""}return b}if(this.zone)return t.log("Zone has already been defined"),this.zone;var A=Array.isArray;A||(A=function(a){return 0<=a.length});r.prototype.o=function(a,b){var c=this.f.length,d;for(d=0;d<c;++d){for(var f=this.f[d],e=void 0,h=void 0,k=void 0,m=0,e=0,k=a.length;e<k;++e){h=f.indexOf(a[e]);if(0<h)throw Error("Invalid injection parameter "+
f);if(0===h&&(++m,1<m))throw Error("Invalid injection parameter "+f);}e=0;for(k=b.length;e<k;++e)if(0<=f.indexOf(b[e]))throw Error("Invalid injection parameter "+f);}};I.prototype.u=function(a){return this.d<=a};h.prototype.inject=function(a){var b=m(arguments);b.o("#?","");b=B(this,0,b,!0,!1);if(null===b)throw Error("Failed to create injected function");return b};h.prototype.create=function(a){var b;if(0===a.length||0<=a.indexOf("."))throw Error("Invalid name "+a);(b=this.l[a])||(b=new h(a,this,
null));return b};h.prototype.configure=function(a){if(!A(a))throw Error("Imports are not an array");if(this.k)throw Error("Module has already been configured "+this.a);H(this);this.k=a.slice();return this};h.prototype.get=function(a){var b=C(a,this,0,!0,{});if(b)return G(b);throw Error("Not found "+a);};h.prototype.factory=function(a,b){v(arguments,2);var c=m(Array.prototype.slice.call(arguments,1)),d=q(a);return z(this,d.name,d.d,[c])};h.prototype.service=function(a,b){v(arguments,2);var c=F(Array.prototype.slice.call(arguments,
1)),d=q(a);return z(this,d.name,d.d,[c])};h.prototype.value=function(a,b){v(arguments,2);var c=q(a);return z(this,c.name,c.d,[w(b)])};h.prototype.constant=function(a,b){v(arguments,2);if(null!==b){var c=typeof b;if("object"===c||"function"===c)Object.freeze(b),Object.seal(b)}c=q(a);return z(this,c.name,c.d,[w(b)])};h.prototype.interceptor=function(a,b){var c=this;if("string"===typeof a){var d=new p(this.c,a,this),c=d.b;null===c&&(c=y(this.c,d.g,!0));a=function(a,b){return c.a===a&&b===d.e}}if("function"!==
typeof a)throw Error("Invalid interceptor "+a);var f=m(Array.prototype.slice.call(arguments,1));f.o("?","#");this.c.p.push(new M(this,a,f));return this};return this.zone=E()}).call(this,console||{log:function(){}});
