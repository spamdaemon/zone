'use strict';(function(s){function C(){function a(a,d){return D(b,a,d)}var b=new e("",null,[]);a.asFunction=function(a){p(arguments,2);return q(arguments)};a.asConstructor=function(a){p(arguments,2);return E(arguments)};a.asValue=function(a){p(arguments,1);return t(a)};a.inject=function(a,d){p(arguments,3);var h="",f=arguments;"string"===typeof arguments[0]&&(h=a,f=Array.prototype.slice.call(f,1));var k=q(f),m=null;return function(){null===m&&(m=D(b,h,!0).inject(k));return m.apply(this,arguments)}};
a.get=function(a){p(arguments,1);var d=new z(b,a,b);if(null===d.b)throw Error("Not found "+a);return d.b.get(d.j)};a.reset=function(){b=new e("",null,[])};a.makeZone=function(){return C()};a.version=function(){return"1.0"};return a}function F(a){var b,c,d,h,f,k;if(a.t)return a.value;if(!0===a.n)throw Error("Cyclic dependency detected with "+a.g);a.n=!0;if(a.f instanceof u)h=a.f.value;else{try{try{b=A(a.b,2,a.f,!1,!0)}catch(m){throw s.log("Failed to resolve "+a.g),m;}if(null===b)throw s.log("Failed to resolve "+
a.g),Error("Failed to resolve "+a.g);}finally{a.n=!1}try{h=b()}catch(g){throw Error("Failed to resolve "+a.g+"\n"+g.toString());}}b=a.b.c.p||[];f=0;for(k=b.length;f<k;++f)if(c=b[f],c.v(a.b.a,a.name)){try{d=A(c.b,2,c.f,!1,!0)}catch(l){throw s.log("Interceptor for "+a.g+" failed"),l;}if(null===d)throw Error("Failed to resolve interceptor for "+a.name);h=d()(h,a.b.a,a.name)}a.value=h;a.t=!0;delete a.f;return h}function A(a,b,c,d,h){var f,k,m,g,l,e,q,n,p,r;p=c.e;r=c.h;m=c.isConstructor;g=[];l=[null];
f=0;for(k=p.length;f<k;++f)if(e=p[f],"#"===e[0]){if(!d)throw Error("Free arguments are not allowed");g.push(l.length);l.push(void 0)}else if(n=!1,"?"===e[0]&&(n=!0,e=e.substr(1)),c=B(e,a,b,{})){try{q=F(c)}catch(t){throw s.log("Injection failed: "+e),t;}l.push(q)}else if(n)l.push(void 0);else return s.log("Injectable not found: "+e),null;k=g.length;return function(){for(f=0;f<k;++f)l[g[f]]=arguments[f];h||(l[0]=this);var a=Function.prototype.bind.apply(r,l);return m?new a:a()}}function B(a,b,c,d){var h,
f,k,e,g,l;k=new z(b.c,a,b);a=k.b;k=k.j;if(a!==b){g=b;if(g===a)g=2;else{for(;g&&g!==a;)g=g.r;g=null===g?0:1}c=Math.min(c,g)}d=d||{};for(g=null;!g&&a;){a.s=!0;if((g=a.l[k])&&g.u(c))break;g=null;if(!g){if(!0===d[a.a])throw Error("Cyclic dependency : "+a.a);try{for(d[a.a]=!0,l=a.i||[],a.i=l,h=0,f=l.length;h<f&&!g;++h){e=v(b.c,l[h],!1);if(null===e)throw Error("Invalid dependency : "+l[h]);g=B(k,e,0,d)}}finally{d[a.a]=!1}c=1;a=a.r}}return g}function z(a,b,c){this.b=c;this.j=b;this.m=".";c=b.lastIndexOf(".");
0<=c&&(this.m=b.substring(0,c),this.b=v(a,this.m,!1),this.j=b.substr(c+1))}function w(a,b,c,d){p(d,2);if(0===b.length||0<=b.indexOf("."))throw Error("Invalid name to bind "+b);if(a.l[b])throw Error("Name "+b+" already bound in "+a.a);G(a);d=d instanceof u||d instanceof n?d:1!==d.length||"function"===typeof d[0]||d[0]instanceof n?q(d):t(d[0]);d instanceof n&&d.o("?","#");c=new H(a,b,c,d);a.l[b]=c;return a}function H(a,b,c,d){this.t=!1;this.value=null;this.b=a;this.name=b;this.g=I(a.a,b);this.f=d;this.n=
!1;switch(c){case 0:case 2:case 1:this.d=c;break;default:throw Error("Invalid access "+c);}}function E(a){a=q(a);a.isConstructor=!0;return a}function q(a){return a instanceof n?a:1===a.length&&a[0]instanceof n?a[0]:new n(a)}function t(a){return a instanceof u?a:new u(a)}function u(a){this.value=a}function L(a,b,c){this.b=a;this.v=b;this.f=c}function n(a){var b;this.isConstructor=!1;if(1===a.length&&x(a[0]))b=a[0].length,this.e=a[0].slice(0,b-1),this.h=a[0][b-1],J(this.e,this.h);else if(2===a.length)this.e=
a[0].slice(),this.h=a[1],J(this.e,this.h);else if("function"===typeof a[0]){if(this.h=a[0],this.e=K(this.h),null===this.e)throw Error("Failed to determine function signature");}else throw Error("Invalid function description"+JSON.stringify(a));}function J(a,b){var c=K(b);if(null!==c&&c.length!==a.length)throw Error("Formals and parameter names do not match");}function D(a,b,c){if(!b)return a;if(a=v(a,b,!c))return a;throw Error("Module not found "+b);}function v(a,b,c){var d=a.q[b],d=d||null;if(!d&&
c)for(b=b.split(/\./),d=a,a=0,c=b.length;a<c;++a)d=d.create(b[a],null);return d}function G(a){if(a.s)throw Error("Module "+a.a+" is sealed");}function e(a,b,c){this.k={};this.r=b;this.i=c;this.s=!1;this.l={};this.a=a;if(b){if(b.k[a])throw Error("Module "+this.a+" already contains a module "+a);this.a=I(b.a,a);this.c=b.c;b.k[a]=this}else this.p=[],this.c=this,this.q={};this.c.q[this.a]=this}function I(a,b){return""===a?b:a+"."+b}function K(a){if("function"!==typeof a)throw Error("Not a function: "+
a);a=a.toString();var b=a.match(/^\s*function\s*(?:\w*\s*)?\(([\s\S]*?)\)/),b=b?b[1]?b[1].trim().split(/\s*,\s*/):[]:null;null===b&&s.log("Failed to parse the function (perhaps it is too long?) : "+a);return b}function p(a,b){r(a,1);if(!(a.length<=b))throw Error("Expected at most "+b+" arguments, but got "+a.length);}function r(a,b){if(!(a.length>=b))throw Error("Expected at least "+b+" arguments, but got "+a.length);}function y(a){var b={};switch(a[0]){case "-":b.d=2;b.name=a.substr(1);break;case "+":b.d=
0;b.name=a.substr(1);break;case "#":b.d=1;b.name=a.substr(1);break;default:b.d=0,b.name=a}return b}if(this.zone)return s.log("Zone has already been defined"),this.zone;var x=Array.isArray;x||(x=function(a){return 0<=a.length});n.prototype.o=function(a,b){var c=this.e.length,d;for(d=0;d<c;++d){for(var h=this.e[d],f=void 0,e=void 0,m=void 0,g=0,f=0,m=a.length;f<m;++f){e=h.indexOf(a[f]);if(0<e)throw Error("Invalid injection parameter "+h);if(0===e&&(++g,1<g))throw Error("Invalid injection parameter "+
h);}f=0;for(m=b.length;f<m;++f)if(0<=h.indexOf(b[f]))throw Error("Invalid injection parameter "+h);}};H.prototype.u=function(a){return this.d<=a};e.prototype.inject=function(a){var b=q(arguments);b.o("#?","");b=A(this,0,b,!0,!1);if(null===b)throw Error("Failed to create injected function");return b};e.prototype.create=function(a){var b;if(0===a.length||0<=a.indexOf("."))throw Error("Invalid name "+a);(b=this.k[a])||(b=new e(a,this,null));return b};e.prototype.configure=function(a){if(!x(a))throw Error("Imports are not an array");
if(this.i)throw Error("Module has already been configured "+this.a);G(this);this.i=a.slice();return this};e.prototype.get=function(a){var b=B(a,this,0,{});if(b)return F(b);throw Error("Not found "+a);};e.prototype.factory=function(a,b){r(arguments,2);var c=q(Array.prototype.slice.call(arguments,1)),d=y(a);return w(this,d.name,d.d,[c])};e.prototype.service=function(a,b){r(arguments,2);var c=E(Array.prototype.slice.call(arguments,1)),d=y(a);return w(this,d.name,d.d,[c])};e.prototype.value=function(a,
b){r(arguments,2);var c=y(a);return w(this,c.name,c.d,[t(b)])};e.prototype.constant=function(a,b){r(arguments,2);if(null!==b){var c=typeof b;if("object"===c||"function"===c)Object.freeze(b),Object.seal(b)}c=y(a);return w(this,c.name,c.d,[t(b)])};e.prototype.interceptor=function(a,b){var c=this;if("string"===typeof a){var d=new z(this.c,a,this),c=d.b;null===c&&(c=v(this.c,d.m,!0));a=function(a,b){return c.a===a&&b===d.j}}if("function"!==typeof a)throw Error("Invalid interceptor "+a);var e=q(Array.prototype.slice.call(arguments,
1));e.o("?","#");this.c.p.push(new L(this,a,e));return this};return this.zone=C()}).call(this,console||{log:function(){}});
