(function(s){function E(a){var b,c,d,e,f,l;if(a.hasOwnProperty("value"))return a.value;if(!0===a.m)throw Error("Cyclic dependency detected with "+a.f);a.m=!0;if(a.e instanceof u)e=a.e.value;else{try{try{b=A(a.b,2,a.e,!1,!0)}catch(L){throw s.log("Failed to resolve "+a.f),L;}if(null===b)throw s.log("Failed to resolve "+a.f),Error("Failed to resolve "+a.f);}finally{a.m=!1}try{e=b()}catch(k){throw Error("Failed to resolve "+a.f+"\n"+k.toString());}}b=m.o||[];f=0;for(l=b.length;f<l;++f)if(c=b[f],c.s(a.b.a,
a.name)){try{d=A(c.b,2,c.e,!1,!0)}catch(g){throw s.log("Interceptor for "+a.f+" failed"),g;}if(null===d)throw Error("Failed to resolve interceptor for "+a.name);e=d()(e,a.b.a,a.name)}a.value=e;delete a.e;return a.value}function A(a,b,c,d,e){var f,l,g,k,q,r,n,h,m,p;m=c.d;p=c.g;g=c.isConstructor;k=[];q=[null];f=0;for(l=m.length;f<l;++f)if(r=m[f],"#"===r[0]){if(!d)throw Error("Free arguments are not allowed");k.push(q.length);q.push(void 0)}else if(h=!1,"?"===r[0]&&(h=!0,r=r.substr(1)),c=B(r,a,b,{})){try{n=
E(c)}catch(t){throw s.log("Injection failed: "+r),t;}q.push(n)}else if(h)q.push(void 0);else return s.log("Injectable not found: "+r),null;l=k.length;return function(){for(f=0;f<l;++f)q[k[f]]=arguments[f];e||(q[0]=this);var a=Function.prototype.bind.apply(p,q);return g?new a:a()}}function B(a,b,c,d){var e,f,l,g,k;l=new C(a,b);a=l.b;l=l.i;if(a!==b){if(b===a)b=2;else{for(;b&&b!==a;)b=b.p;b=null===b?0:1}c=Math.min(c,b)}d=d||{};for(b=null;!b&&a;){a.q=!0;if((b=a.k[l])&&b.r(c))break;b=null;if(!b){if(!0===
d[a.a])throw Error("Cyclic dependency : "+a.a);try{for(d[a.a]=!0,k=a.h||[],a.h=k,e=0,f=k.length;e<f&&!b;++e){g=v(k[e],!1);if(null===g)throw Error("Invalid dependency : "+k[e]);b=B(l,g,0,d)}}finally{d[a.a]=!1}c=1;a=a.p}}return b}function C(a,b){this.b=b;this.i=a;this.l=".";var c;c=a.lastIndexOf(".");0<=c&&(this.l=a.substring(0,c),this.b=v(this.l,!1),this.i=a.substr(c+1))}function w(a,b,c,d){p(d,2);if(0===b.length||0<=b.indexOf("."))throw Error("Invalid name to bind "+b);if(a.k[b])throw Error("Name "+
b+" already bound in "+a.a);F(a);d=d instanceof u||d instanceof n?d:1!==d.length||"function"===typeof d[0]||d[0]instanceof n?h(d):x(d[0]);d instanceof n&&d.n("?","#");c=new G(a,b,c,d);a.k[b]=c;return a}function G(a,b,c,d){this.b=a;this.name=b;this.f=H(a.a,b);this.e=d;this.m=!1;switch(c){case 0:case 2:case 1:this.c=c;break;default:throw Error("Invalid access "+c);}}function I(a){a=h(a);a.isConstructor=!0;return a}function h(a){return a instanceof n?a:1===a.length&&a[0]instanceof n?a[0]:new n(a)}function x(a){return a instanceof
u?a:new u(a)}function u(a){this.value=a}function M(a,b,c){this.b=a;this.s=b;this.e=c}function n(a){var b;this.isConstructor=!1;if(1===a.length&&y(a[0]))b=a[0].length,this.d=a[0].slice(0,b-1),this.g=a[0][b-1],J(this.d,this.g);else if(2===a.length)this.d=a[0].slice(),this.g=a[1],J(this.d,this.g);else if("function"===typeof a[0]){if(this.g=a[0],this.d=K(this.g),null===this.d)throw Error("Failed to determine function signature");}else throw Error("Invalid function description"+JSON.stringify(a));}function J(a,
b){var c=K(b);if(null!==c&&c.length!==a.length)throw Error("Formals and parameter names do not match");}function v(a,b){var c=D[a],d,e,f,c=c||null;if(!c&&b)for(d=a.split(/\./),c=m,e=0,f=d.length;e<f;++e)c=c.create(d[e],null);return c}function F(a){if(a.q)throw Error("Module "+a.a+" is sealed");}function g(a,b,c){this.j={};this.p=b;this.h=c;this.q=!1;this.k={};this.a=a;if(b){if(b.j[a])throw Error("Module "+this.a+" already contains a module "+a);this.a=H(b.a,a);b.j[a]=this}else this.o=[];D[this.a]=
this}function K(a){if("function"!==typeof a)throw Error("Not a function: "+a);a=a.toString();var b=a.match(/^\s*function\s*(?:\w*\s*)?\(([\s\S]*?)\)/),b=b?b[1]?b[1].trim().split(/\s*,\s*/):[]:null;null===b&&s.log("Failed to parse the function (perhaps it is too long?) : "+a);return b}function H(a,b){return""===a?b:a+"."+b}function p(a,b){t(a,1);if(!(a.length<=b))throw Error("Expected at most "+b+" arguments, but got "+a.length);}function t(a,b){if(!(a.length>=b))throw Error("Expected at least "+b+
" arguments, but got "+a.length);}function z(a){var b={};switch(a[0]){case "-":b.c=2;b.name=a.substr(1);break;case "+":b.c=0;b.name=a.substr(1);break;case "#":b.c=1;b.name=a.substr(1);break;default:b.c=0,b.name=a}return b}if(this.zone)return s.log("Zone has already been defined"),this.zone;var D={},y=Array.isArray;y||(y=function(a){return 0<=a.length});var m=new g("",null,[]);n.prototype.n=function(a,b){var c=this.d.length,d;for(d=0;d<c;++d){for(var e=this.d[d],f=void 0,g=void 0,h=void 0,k=0,f=0,
h=a.length;f<h;++f){g=e.indexOf(a[f]);if(0<g)throw Error("Invalid injection parameter "+e);if(0===g&&(++k,1<k))throw Error("Invalid injection parameter "+e);}f=0;for(h=b.length;f<h;++f)if(0<=e.indexOf(b[f]))throw Error("Invalid injection parameter "+e);}};G.prototype.r=function(a){return this.c<=a};g.prototype.inject=function(a){var b=h(arguments);b.n("#?","");b=A(this,0,b,!0,!1);if(null===b)throw Error("Failed to create injected function");return b};g.prototype.create=function(a){var b;if(0===a.length||
0<=a.indexOf("."))throw Error("Invalid name "+a);(b=this.j[a])||(b=new g(a,this,null));return b};g.prototype.configure=function(a){if(!y(a))throw Error("Imports are not an array");if(this.h)throw Error("Module has already been configured "+this.a);F(this);this.h=a.slice();return this};g.prototype.get=function(a){var b=B(a,this,0,{});if(b)return E(b);throw Error("Not found "+a);};g.prototype.factory=function(a,b){t(arguments,2);var c=h(Array.prototype.slice.call(arguments,1)),d=z(a);return w(this,
d.name,d.c,[c])};g.prototype.service=function(a,b){t(arguments,2);var c=I(Array.prototype.slice.call(arguments,1)),d=z(a);return w(this,d.name,d.c,[c])};g.prototype.value=function(a,b){t(arguments,2);var c=z(a);return w(this,c.name,c.c,[x(b)])};g.prototype.constant=function(a,b){t(arguments,2);if(null!==b){var c=typeof b;if("object"===c||"function"===c)Object.freeze(b),Object.seal(b)}c=z(a);return w(this,c.name,c.c,[x(b)])};g.prototype.interceptor=function(a,b){var c=this;if("string"===typeof a){var d=
new C(a,this),c=d.b;null===c&&(c=v(d.l,!0));a=function(a,b){return c.a===a&&b===d.i}}if("function"!==typeof a)throw Error("Invalid interceptor "+interceptWhat);var e=h(Array.prototype.slice.call(arguments,1));e.n("?","#");m.o.push(new M(this,a,e));return this};this.zone=function(a,b){if(!a)return m;var c=v(a,!b);if(c)return c;throw Error("Module not found "+a);};this.zone.asFunction=function(a){p(arguments,2);return h(arguments)};this.zone.asConstructor=function(a){p(arguments,2);return I(arguments)};
this.zone.asValue=function(a){p(arguments,1);return x(a)};this.zone.inject=function(a,b){p(arguments,3);var c="",d=arguments;"string"===typeof arguments[0]&&(c=a,d=Array.prototype.slice.call(d,1));var e=h(d);return function(){return zone(c,!0).inject(e).apply(null,arguments)}};this.zone.get=function(a){p(arguments,1);var b=new C(a,m);if(null===b.b)throw Error("Not found "+a);return b.b.get(b.i)};this.zone.reset=function(){m=new g("",null,[]);D={}};this.zone.version=function(){return"1.0"};return this.zone}).call(this,
console||{log:function(){}});
