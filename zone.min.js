(function(){function C(a){var b,c,d,f,h,r;if(a.hasOwnProperty("value"))return a.value;if(!0===a.n)throw Error("Cyclic dependency detected with "+a.f);a.n=!0;if(a.e instanceof q)f=a.e.value;else{try{try{b=y(a.b,2,a.e,!1)}catch(k){throw console.log("Failed to resolve "+a.f),k;}if(null===b)throw console.log("Failed to resolve "+a.f),Error("Failed to resolve "+a.f);}finally{a.n=!1}try{f=b()}catch(g){throw Error("Failed to resolve "+a.f+"\n"+g.toString());}}b=a.b.k[a.name]||[];h=0;for(r=b.length;h<r;++h){c=
b[h];try{d=y(c.b,2,c.e,!1)}catch(e){throw console.log("Interceptor for "+a.f+" failed"),e;}if(null===d)throw Error("Failed to resolve interceptor for "+a.name);f=d()(f)}a.value=f;delete a.e;return a.value}function y(a,b,c,d){var f,h,r,k,g,e,n,l,m,p;m=c.d;p=c.g;r=c.isConstructor;k=[];g=[a];f=0;for(h=m.length;f<h;++f)if(e=m[f],"#"===e[0]){if(!d)throw Error("Free arguments are not allowed");k.push(g.length);g.push(void 0)}else if(l=!1,"?"===e[0]&&(l=!0,e=e.substr(1)),c=z(e,a,b,{})){try{n=C(c)}catch(q){throw console.log("Injection failed: "+
e),q;}g.push(n)}else if(l)g.push(void 0);else return console.log("Injectable not found: "+e),null;h=k.length;return function(){for(f=0;f<h;++f)g[k[f]]=arguments[f];var a=Function.prototype.bind.apply(p,g);return r?new a:a()}}function z(a,b,c,d){var f,h,e,k,g;e=new A(a,b);a=e.b;e=e.h;if(a!==b){if(b===a)b=2;else{for(;b&&b!==a;)b=b.p;b=null===b?0:1}c=Math.min(c,b)}d=d||{};for(b=null;!b&&a;){a.q=!0;if((b=a.l[e])&&b.r(c))break;b=null;if(!b){if(!0===d[a.a])throw Error("Cyclic dependency : "+a.a);try{for(d[a.a]=
!0,g=a.i||[],a.i=g,f=0,h=g.length;f<h&&!b;++f){k=s(g[f],!1);if(null===k)throw Error("Invalid dependency : "+g[f]);b=z(e,k,0,d)}}finally{d[a.a]=!1}c=1;a=a.p}}return b}function A(a,b){this.b=b;this.h=a;this.m=".";var c;c=a.lastIndexOf(".");0<=c&&(this.m=a.substring(0,c),this.b=s(this.m,!1),this.h=a.substr(c+1))}function t(a,b,c,d){m(d,2);if(0===b.length||0<=b.indexOf("."))throw Error("Invalid name to bind "+b);if(a.l[b])throw Error("Name "+b+" already bound in "+a.a);D(a);d=d instanceof q||d instanceof
n?d:1!==d.length||"function"===typeof d[0]||d[0]instanceof n?l(d):u(d[0]);d instanceof n&&d.o("?","#");c=new E(a,b,c,d);a.l[b]=c;return a}function E(a,b,c,d){this.b=a;this.name=b;this.f=F(a.a,b);this.e=d;this.n=!1;switch(c){case 0:case 2:case 1:this.c=c;break;default:throw Error("Invalid access "+c);}}function G(a){a=l(a);a.isConstructor=!0;return a}function l(a){return a instanceof n?a:1===a.length&&a[0]instanceof n?a[0]:new n(a)}function u(a){return a instanceof q?a:new q(a)}function q(a){this.value=
a}function J(a,b){this.b=a;this.e=b}function n(a){var b;this.isConstructor=!1;if(1===a.length&&v(a[0]))b=a[0].length,this.d=a[0].slice(0,b-1),this.g=a[0][b-1],H(this.d,this.g);else if(2===a.length)this.d=a[0].slice(),this.g=a[1],H(this.d,this.g);else if("function"===typeof a[0]){if(this.g=a[0],this.d=I(this.g),null===this.d)throw Error("Failed to determine function signature");}else throw Error("Invalid function description");}function H(a,b){var c=I(b);if(null!==c&&c.length!==a.length)throw Error("Formals and parameter names do not match");
}function s(a,b){var c=B[a],d,f,e,c=c||null;if(!c&&b)for(d=a.split(/\./),c=w,f=0,e=d.length;f<e;++f)c=c.create(d[f],null);return c}function D(a){if(a.q)throw Error("Module "+a.a+" is sealed");}function e(a,b,c){this.j={};this.p=b;this.i=c;this.q=!1;this.l={};this.k={};this.a=a;if(b){if(b.j[a])throw Error("Module "+this.a+" already contains a module "+a);this.a=F(b.a,a);b.j[a]=this}B[this.a]=this}function I(a){if("function"!==typeof a)throw Error("Not a function: "+a);a=a.toString();var b=a.match(/^\s*function\s*(?:\w*\s*)?\(([\s\S]*?)\)/),
b=b?b[1]?b[1].trim().split(/\s*,\s*/):[]:null;null===b&&console.log("Failed to parse the function (perhaps it is too long?) : "+a);return b}function F(a,b){return""===a?b:a+"."+b}function m(a,b){p(a,1);if(!(a.length<=b))throw Error("Expected at most "+b+" arguments, but got "+a.length);}function p(a,b){if(!(a.length>=b))throw Error("Expected at least "+b+" arguments, but got "+a.length);}function x(a){var b={};switch(a[0]){case "-":b.c=2;b.name=a.substr(1);break;case "+":b.c=0;b.name=a.substr(1);
break;case "#":b.c=1;b.name=a.substr(1);break;default:b.c=0,b.name=a}return b}if(this.zone)return console.log("Zone has already been defined"),this.zone;var B={},v=Array.isArray;v||(v=function(a){return 0<=a.length});var w=new e("",null,[]);n.prototype.o=function(a,b){var c=this.d.length,d;for(d=0;d<c;++d){for(var f=this.d[d],e=void 0,l=void 0,k=void 0,g=0,e=0,k=a.length;e<k;++e){l=f.indexOf(a[e]);if(0<l)throw Error("Invalid injection parameter "+f);if(0===l&&(++g,1<g))throw Error("Invalid injection parameter "+
f);}e=0;for(k=b.length;e<k;++e)if(0<=f.indexOf(b[e]))throw Error("Invalid injection parameter "+f);}};E.prototype.r=function(a){return this.c<=a};e.prototype.inject=function(a){var b=l(arguments);b.o("#?","");b=y(this,0,b,!0);if(null===b)throw Error("Failed to create injected function");return b};e.prototype.create=function(a){var b;if(0===a.length||0<=a.indexOf("."))throw Error("Invalid name "+a);(b=this.j[a])||(b=new e(a,this,null));return b};e.prototype.configure=function(a){if(!v(a))throw Error("Imports are not an array");
if(this.i)throw Error("Module has already been configured "+this.a);D(this);this.i=a.slice();return this};e.prototype.get=function(a){var b=z(a,this,0,{});if(b)return C(b);throw Error("Not found "+a);};e.prototype.factory=function(a,b){p(arguments,2);var c=l(Array.prototype.slice.call(arguments,1)),d=x(a);return t(this,d.name,d.c,[c])};e.prototype.service=function(a,b){p(arguments,2);var c=G(Array.prototype.slice.call(arguments,1)),d=x(a);return t(this,d.name,d.c,[c])};e.prototype.value=function(a,
b){p(arguments,2);var c=x(a);return t(this,c.name,c.c,[u(b)])};e.prototype.constant=function(a,b){p(arguments,2);if(null!==b){var c=typeof b;if("object"===c||"function"===c)Object.freeze(b),Object.seal(b)}c=x(a);return t(this,c.name,c.c,[u(b)])};e.prototype.interceptor=function(a,b){var c=new A(a,this),d=c.b;null===d&&(d=s(c.m,!0));var e=l(Array.prototype.slice.call(arguments,1));e.o("?","#");var e=new J(this,e),h=d.k[c.h];h||(d.k[c.h]=h=[]);h.push(e);return this};this.zone=function(a,b){if(!a)return w;
var c=s(a,!b);if(c)return c;throw Error("Module not found "+a);};this.zone.asFunction=function(a){m(arguments,2);return l(arguments)};this.zone.asConstructor=function(a){m(arguments,2);return G(arguments)};this.zone.asValue=function(a){m(arguments,1);return u(a)};this.zone.inject=function(a,b){m(arguments,3);var c="",d=arguments;"string"===typeof arguments[0]&&(c=a,d=Array.prototype.slice.call(d,1));var e=l(d);return function(){return zone(c,!0).inject(e).apply(null,arguments)}};this.zone.get=function(a){m(arguments,
1);var b=new A(a,w);if(null===b.b)throw Error("Not found "+a);return b.b.get(b.h)};this.zone.reset=function(){w=new e("",null,[]);B={}};this.zone.version=function(){return"1.0"};return this.zone}).call(this);
