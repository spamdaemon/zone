'use strict';(function(t,F){function C(a){function b(b,d){return n(a,b,d)}b.asFunction=function(a){u(arguments,2);return p(arguments)};b.asConstructor=function(a){u(arguments,2);return G(arguments)};b.asValue=function(a){u(arguments,1);return w(a)};b.inject=function(b,d){u(arguments,3);var f="",e=arguments;"string"===typeof arguments[0]&&(f=b,e=Array.prototype.slice.call(e,1));var l=p(e),k=null;return function(){null===k&&(k=n(a,f,!0).inject(l));return k.apply(this,arguments)}};b.get=function(b){u(arguments,
1);var d=new r(a,b,a);if(null===d.c)throw Error("Not found "+b);return d.c.get(d.local)};b.factory=function(c,d){var f=q(c),e=new r(a,f.name,a),l=n(a,e.f),k=Array.prototype.slice.call(arguments);k[0]=f.prefix+e.local;g.prototype.factory.apply(l,k);return b};b.service=function(c,d){var f=q(c),e=new r(a,f.name,a),l=n(a,e.f),k=Array.prototype.slice.call(arguments);k[0]=f.prefix+e.local;g.prototype.service.apply(l,k);return b};b.value=function(c,d){var f=q(c),e=new r(a,f.name,a);n(a,e.f).value(f.prefix+
e.local,d);return b};b.constant=function(c,d){var f=q(c),e=new r(a,f.name,a);n(a,e.f).constant(f.prefix+e.local,d);return b};b.makeZone=function(){return C(new g("",null,[]))};b.copyZone=function(){return C(H("",a,null))};b.version=function(){return"1.0"};return b}function I(a){var b,c,d,f,e,l,k;if(a.r)return a.value;if(!0===a.m)throw Error("Cyclic dependency detected with "+a.i);a.m=!0;if(a.h instanceof x)e=a.h.value;else{try{try{b=D(a.c,2,a.h,!1,!0)}catch(g){throw t.log("Failed to resolve "+a.i),
g;}if(null===b)throw t.log("Failed to resolve "+a.i),Error("Failed to resolve "+a.i);}finally{a.m=!1}try{e=b()}catch(h){throw Error("Failed to resolve "+a.i+"\n"+h.toString());}}b=a.c.b.l;l=0;for(k=b.length;l<k;++l)if(d=b[l],d.u(a.c.a,a.name)){try{c=n(a.c.b,d.name,!0),f=D(c,2,d.h,!1,!0)}catch(m){throw t.log("Interceptor for "+a.i+" failed"),m;}if(null===f)throw Error("Failed to resolve interceptor for "+a.name);e=f()(e,a.c.a,a.name)}a.value=e;a.r=!0;return e}function D(a,b,c,d,f){var e,l,k,g,h,m,
q,n,p,r;p=c.names;r=c.j;k=c.isConstructor;g=[];h=[null];e=0;for(l=p.length;e<l;++e)if(m=p[e],"#"===m[0]){if(!d)throw Error("Free arguments are not allowed");g.push(h.length);h.push(F)}else if(n=!1,"?"===m[0]&&(n=!0,m=m.substr(1)),c=E(m,a,b,!0,{})){try{q=I(c)}catch(s){throw t.log("Injection failed: "+m),s;}h.push(q)}else if(n)h.push(F);else return t.log("Injectable not found: "+m),null;l=g.length;return function(){for(e=0;e<l;++e)h[g[e]]=arguments[e];f||(h[0]=this);var a=Function.prototype.bind.apply(r,
h);return k?new a:a()}}function E(a,b,c,d,f){var e,l,k,g,h,m;k=new r(b.b,a,b);a=k.c;k=k.local;if(a!==b){h=b;if(h===a)h=2;else{for(;h&&h!==a;)h=h.p;h=null===h?0:1}c=Math.min(c,h)}f=f||{};for(h=null;!h&&a;){a.q=!0;if((h=a.g[k])&&h.t(c))break;h=null;if(!d)break;if(!h){if(!0===f[a.a])throw Error("Cyclic dependency : "+a.a);try{for(f[a.a]=!0,m=a.e||[],a.e=m,e=0,l=m.length;e<l&&!h;++e){g=y(b.b,m[e],!1);if(null===g)throw Error("Invalid dependency : "+m[e]);h=E(k,g,0,!1,f)}}finally{f[a.a]=!1}c=1;a=a.p}}return h}
function r(a,b,c){this.c=c;this.local=b;this.f=".";c=b.lastIndexOf(".");0<=c&&(this.f=b.substring(0,c),this.local=b.substr(c+1),this.c=y(a,this.f,!1))}function z(a,b,c,d){u(d,2);if(0===b.length||0<=b.indexOf("."))throw Error("Invalid name to bind "+b);if(a.g[b])throw Error("Name "+b+" already bound in "+a.a);J(a);d=d instanceof x||d instanceof s?d:1!==d.length||"function"===typeof d[0]||d[0]instanceof s?p(d):w(d[0]);d instanceof s&&d.n("?","#");c=new A(a,b,c,d);a.g[b]=c;return a}function A(a,b,c,
d){this.r=!1;this.value=null;this.c=a;this.name=b;this.i=K(a.a,b);this.h=d;this.m=!1;switch(c){case 0:case 2:case 1:this.d=c;break;default:throw Error("Invalid access "+c);}}function G(a){a=p(a);a.isConstructor=!0;return a}function p(a){return a instanceof s?a:1===a.length&&a[0]instanceof s?a[0]:new s(a)}function w(a){return a instanceof x?a:new x(a)}function x(a){this.value=a}function N(a,b,c){this.name=a;this.u=b;this.h=c}function s(a){var b;this.isConstructor=!1;if(1===a.length&&B(a[0]))b=a[0].length,
this.names=a[0].slice(0,b-1),this.j=a[0][b-1],L(this.names,this.j);else if(2===a.length)this.names=a[0].slice(),this.j=a[1],L(this.names,this.j);else if("function"===typeof a[0]){if(this.j=a[0],this.names=M(this.j),null===this.names)throw Error("Failed to determine function signature");}else throw Error("Invalid function description"+JSON.stringify(a));}function L(a,b){var c=M(b);if(null!==c&&c.length!==a.length)throw Error("Formals and parameter names do not match");}function n(a,b,c){if(!b)return a;
if(a=y(a,b,!c))return a;throw Error("Module not found "+b);}function y(a,b,c){var d=a.o[b],d=d||null;if(!d&&c)for(b=b.split(/\./),d=a,a=0,c=b.length;a<c;++a)d=d.create(b[a],null);return d}function J(a){if(a.q)throw Error("Module "+a.a+" is sealed");}function H(a,b,c){a=new g(a,c,null);b.e&&(a.e=b.e.slice());var d,f;a.b===a&&(a.l=b.l.slice());for(f in b.g)a.g[f]=b.g[f].s(a);for(d in b.k)H(d,b.k[d],a);return a}function g(a,b,c){this.k={};this.p=b;this.e=c;this.q=!1;this.g={};this.a=a;if(b){if(b.k[a])throw Error("Module "+
this.a+" already contains a module "+a);this.a=K(b.a,a);this.b=b.b;b.k[a]=this}else this.l=[],this.b=this,this.o={};this.b.o[this.a]=this}function K(a,b){return""===a?b:a+"."+b}function M(a){if("function"!==typeof a)throw Error("Not a function: "+a);a=a.toString();var b=a.match(/^\s*function\s*(?:\w*\s*)?\(([\s\S]*?)\)/),b=b?b[1]?b[1].trim().split(/\s*,\s*/):[]:null;null===b&&t.log("Failed to parse the function (perhaps it is too long?) : "+a);return b}function u(a,b){v(a,1);if(!(a.length<=b))throw Error("Expected at most "+
b+" arguments, but got "+a.length);}function v(a,b){if(!(a.length>=b))throw Error("Expected at least "+b+" arguments, but got "+a.length);}function q(a){var b={};switch(a[0]){case "-":b.d=2;b.name=a.substr(1);b.prefix="-";break;case "+":b.d=0;b.name=a.substr(1);b.prefix="";break;case "#":b.d=1;b.name=a.substr(1);b.prefix="#";break;default:b.d=0,b.name=a,b.prefix=""}return b}if(this.zone)return t.log("Zone has already been defined"),this.zone;var B=Array.isArray;B||(B=function(a){return 0<=a.length});
s.prototype.n=function(a,b){var c=this.names.length,d;for(d=0;d<c;++d){for(var f=this.names[d],e=void 0,g=void 0,k=void 0,n=0,e=0,k=a.length;e<k;++e){g=f.indexOf(a[e]);if(0<g)throw Error("Invalid injection parameter "+f);if(0===g&&(++n,1<n))throw Error("Invalid injection parameter "+f);}e=0;for(k=b.length;e<k;++e)if(0<=f.indexOf(b[e]))throw Error("Invalid injection parameter "+f);}};A.prototype.s=function(a){return new A(a,this.name,this.d,this.h)};A.prototype.t=function(a){return this.d<=a};g.prototype.inject=
function(a){var b=p(arguments);b.n("#?","");b=D(this,0,b,!0,!1);if(null===b)throw Error("Failed to create injected function");return b};g.prototype.create=function(a){var b;if(0===a.length||0<=a.indexOf("."))throw Error("Invalid name "+a);(b=this.k[a])||(b=new g(a,this,null));return b};g.prototype.configure=function(a){if(!B(a))throw Error("Imports are not an array");if(this.e)throw Error("Module has already been configured "+this.a);J(this);this.e=a.slice();return this};g.prototype.get=function(a){var b=
E(a,this,0,!0,{});if(b)return I(b);throw Error("Not found "+a);};g.prototype.factory=function(a,b){v(arguments,2);var c=p(Array.prototype.slice.call(arguments,1)),d=q(a);return z(this,d.name,d.d,[c])};g.prototype.service=function(a,b){v(arguments,2);var c=G(Array.prototype.slice.call(arguments,1)),d=q(a);return z(this,d.name,d.d,[c])};g.prototype.value=function(a,b){v(arguments,2);var c=q(a);return z(this,c.name,c.d,[w(b)])};g.prototype.constant=function(a,b){v(arguments,2);if(null!==b){var c=typeof b;
if("object"===c||"function"===c)Object.freeze(b),Object.seal(b)}c=q(a);return z(this,c.name,c.d,[w(b)])};g.prototype.interceptor=function(a,b){var c=this;if("string"===typeof a){var d=new r(this.b,a,this),c=d.c;null===c&&(c=y(this.b,d.f,!0));a=function(a,b){return c.a===a&&b===d.local}}if("function"!==typeof a)throw Error("Invalid interceptor "+a);var f=p(Array.prototype.slice.call(arguments,1));f.n("?","#");this.b.l.push(new N(this.a,a,f));return this};return this.zone=C(new g("",null,[]))}).call(this,
console||{log:function(){}});
